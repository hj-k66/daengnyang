<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/header :: head}">
  <!-- @{...}는 타임리프의 기본 링크 표현 구문 -->
  <!-- Required meta tags -->
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet"
        href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk"
        crossorigin="anonymous"/>
  <title>게시판</title>


  <style>
    .hidden {
      display: none;
    }
  </style>
</head>

<body>
<div th:replace="~{fragments/header :: header}"/>

<div class="row">
  <div class="col-md-3">
  </div>
  <div class="col-md-6 my-3">
    <div class="col-md-12 my-3">
      <div
          class="row g-0 border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative">
        <div class="col p-4 d-flex flex-column position-static">
          <strong class="d-inline-block mb-2 text-success"
          >#<span id="tag">태그</span></strong>
          <h3 id="title" class="mb-0">제목</h3>

          <table class="table table-sm mt-5 table-borderless">
            <thead>
            <tr>
              <th scope="col" style="text-decoration: underline" colspan="2">애기이름</th>
              <th scope="col" id="petName" colspan="2" style="width: 40%;">멍멍</th>
              <th scope="col" class="align-bottom" style="font-size: small">작성일시</th>
              <td id="createdAt" class="text-muted align-bottom" style="font-size: small">0000-00-00
                00:00:00
              </td>
            </tr>
            </thead>
            <tbody>
            <tr>
              <th scope="row" style="text-decoration: underline" colspan="2">작성자</th>
              <th colspan="2" id="userName">이름</th>
              <th class="align-top" style="font-size: small">수정일시</th>
              <td id="lastModifiedAt" class="text-muted align-top" style="font-size: small">
                0000-00-00 00:00:00
              </td>
            </tr>
            </tbody>
          </table>

          <div id="body-box" class="mb-auto">-</div>

          <div id="carouselExample" class="carousel slide mx-3 my-5"
               style="width: 400px; height: 300px;">
            <div class="carousel-inner">
              <div class="carousel-item">
                <img
                    src="https://image.oliveyoung.co.kr/uploads/images/goods/550/10/0000/0014/B00000014213905ko.jpg?l=ko"
                    class="d-block w-100" alt="...">
              </div>
              <div class="carousel-item active">
                <img
                    src="https://cdn.pixabay.com/photo/2019/07/23/13/51/shepherd-dog-4357790_1280.jpg"
                    class="d-block w-100" alt="...">
              </div>
              <div class="carousel-item">
                <img src="https://img.catpre.com/mobile/catpre/product/24/23345_detail_9071.png"
                     class="d-block w-100" alt="...">
              </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample"
                    data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselExample"
                    data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Next</span>
            </button>
          </div>

          <!--          <div id="image-box" class="col-auto d-none d-lg-block mt-5">-->
          <!--            <img src="https://cdn.pixabay.com/photo/2019/07/23/13/51/shepherd-dog-4357790_1280.jpg"-->
          <!--                 width="250" height="250" class="img-thumbnail" alt="강아지">-->
          <!--            <img src="https://cdn.pixabay.com/photo/2019/07/23/13/51/shepherd-dog-4357790_1280.jpg"-->
          <!--                 width="250" height="250" class="img-thumbnail" alt="강아지">-->
          <!--            <img src="https://cdn.pixabay.com/photo/2019/07/23/13/51/shepherd-dog-4357790_1280.jpg"-->
          <!--                 width="250" height="250" class="img-thumbnail" alt="강아지">-->
          <!--          </div>-->
        </div>
      </div>
    </div>
    <div class="d-grid gap-2 d-md-flex justify-content-md-end my-3">
      <button id="btn-modify" class="btn btn-warning">수정</button>
      <button id="btn-delete" class="btn btn-danger mx-2">삭제</button>
      <button onclick="history.back()" class="btn btn-primary">돌아가기</button>
    </div>
    <div class="card">
      <div class="card-body"><textarea class="form-control" row="1"></textarea></div>
      <div class="card-footer d-grid gap-2 d-md-flex justify-content-md-end">
        <button class="btn btn-primary">등록</button>
      </div>
    </div>
    <br/>
    <div class="card">
      <div class="card-header">댓글리스트</dv>
        <ui id="comment--box" class="light-group">
          <li id="comment--1" class="list-group-item d-flex justify-content-between my-3">
            <div>댓글 내용입니다.</div>
            <div class="d-flex">
              <div class="front-italic">작성자 : 이상훈</div>
              <button class="badge">삭제</button>
            </div>
          </li>
          <li id="comment--2" class="list-group-item d-flex justify-content-between my-3">
            <div>댓글 내용입니다.</div>
            <div class="d-flex">
              <div class="front-italic">작성자 : 이상훈</div>
              <button class="badge">삭제</button>
            </div>
          </li>
        </ui>
      </div>
    </div>
  </div>
  <div class="col-md-3 my-3 mt-5">
    <th:block th:replace="~{fragments/right :: right}"></th:block>
  </div>
</div>
</div>

<footer th:replace="~{fragments/footer :: footerFragment}"></footer>
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
        integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script th:inline="javascript">
  const petId = [[${petId}]];
  const recordId = [[${recordId}]];
  let author;

  $(document).ready(function () {
    get_record_detail();
  });

  async function get_record_detail() {
    await axios.get("/api/v1/pets/" + petId + "/records/" + recordId, {}, {
      headers: {},
    }).then(res => {
      console.log(res)
      if (res.data.resultCode == 'SUCCESS') {
        let data = res.data.result;
        author = data.userName;

        let id = data.id;
        let userId = data.userId;
        let petId = data.petId;
        let petName = data.petName;
        let title = data.title;
        let body = data.body;
        let userName = data.userName;
        let isPublic = data.isPublic;
        let tag = data.tag;
        // let recordFiles = data.recordFiles;
        // let recordFile = data.recordFile;
        let createdAt = data.createdAt;
        let lastModifiedAt = data.lastModifiedAt;

        $('#id').text(id);
        $('#userId').text(userId);
        $('#petId').text(petId);
        $('#petName').text(petName);
        $('#title').text(title);
        $('#body-box').text(body);
        $('#userName').text(userName);
        $('#isPublic').text(isPublic);
        $('#tag').text(tag);
        $('#createdAt').text(createdAt);
        $('#lastModifiedAt').text(lastModifiedAt);
      } else {
        console.log("실패임" + res.resultCode)
      }
      setTimeout(async () => {
        await get_my_name(function (user) {
          if (user !== author) {
            document.getElementById('btn-delete').remove();
            document.getElementById('btn-modify').remove();
          }
        });
      })
    });
  }

  async function get_my_name(callback) {
    let user;
    await axios.get("/api/v1/users/myname", {}, {
      headers: {},
    }).then(res => {
      if (res.data.resultCode == 'SUCCESS') {
        console.log(res.data.result)
        user = res.data.result;
      } else {
        console.log("실패임" + res.resultCode)
      }
    });
    callback(user);
  }

  axios.interceptors.request.use(function (config) {
    console.log("인터셉터 시작")
    const accessToken = localStorage.getItem('accessToken');
    if (accessToken) {
      config.headers.Authorization = 'Bearer' + ' ' + accessToken
    } else {
      console.log("headers" + config.headers);
    }
    return config;
  })

</script>
</body>
</html>
